import Component from 'hyper/component'
import React from 'react'
import SvgIcon from '../utils/svg-icon'
import getWeather from '../utils/getWeather'

const Icons = {
  'partly-cloudy-day': (
    <path d="M79.941,43.641h-4c-1.104,0-2-0.895-2-2c0-1.104,0.896-1.998,2-1.998h4 c1.104,0,2,0.895,2,1.998C81.941,42.746,81.045,43.641,79.941,43.641z M72.084,30.329c-0.781,0.781-2.047,0.781-2.828,0 c-0.781-0.78-0.781-2.047,0-2.827l2.828-2.828c0.781-0.781,2.047-0.781,2.828,0c0.781,0.78,0.781,2.047,0,2.828L72.084,30.329z M69.137,45.936L69.137,45.936c1.749,2.086,2.806,4.77,2.806,7.705c0,6.625-5.372,11.998-11.999,11.998c-2.775,0-12.801,0-15.998,0 c-8.835,0-15.998-7.162-15.998-15.998s7.163-15.998,15.998-15.998c1.572,0,3.09,0.232,4.523,0.654 c2.195-2.827,5.618-4.654,9.475-4.654c6.627,0,11.999,5.373,11.999,11.998C69.942,43.156,69.649,44.602,69.137,45.936z M31.947,49.641c0,6.627,5.371,11.998,11.998,11.998c3.616,0,12.979,0,15.998,0c4.418,0,7.999-3.582,7.999-7.998 c0-4.418-3.581-8-7.999-8c-1.6,0-3.083,0.482-4.333,1.291c-1.231-5.316-5.974-9.289-11.665-9.289 C37.318,37.643,31.947,43.014,31.947,49.641z M57.943,33.643c-2.212,0-4.215,0.898-5.662,2.349c2.34,1.436,4.285,3.453,5.629,5.854 c0.664-0.113,1.337-0.205,2.033-0.205c2.125,0,4.119,0.559,5.85,1.527l0,0c0.096-0.494,0.15-1.004,0.15-1.527 C65.943,37.225,62.361,33.643,57.943,33.643z M57.943,25.643c-1.104,0-1.999-0.895-1.999-1.999v-3.999c0-1.105,0.896-2,1.999-2 c1.105,0,2,0.895,2,2v3.999C59.943,24.749,59.049,25.643,57.943,25.643z M43.803,30.329l-2.827-2.827 c-0.781-0.781-0.781-2.048,0-2.828c0.78-0.781,2.047-0.781,2.827,0l2.828,2.828c0.781,0.78,0.781,2.047,0,2.827 C45.851,31.11,44.584,31.11,43.803,30.329z" />
  ),

  'partly-cloudy-night': (
    <path d="M69.763,46.758L69.763,46.758c1.368,1.949,2.179,4.318,2.179,6.883 c0,6.625-5.371,11.998-11.998,11.998c-2.775,0-12.801,0-15.998,0c-8.836,0-15.998-7.162-15.998-15.998s7.162-15.998,15.998-15.998 c2.002,0,3.914,0.375,5.68,1.047l0,0c1.635-4.682,6.078-8.047,11.318-8.047c0.755,0,1.491,0.078,2.207,0.212 c-0.131,0.575-0.207,1.173-0.207,1.788c0,4.418,3.581,7.999,7.998,7.999c0.616,0,1.213-0.076,1.789-0.208 c0.133,0.717,0.211,1.453,0.211,2.208C72.941,41.775,71.73,44.621,69.763,46.758z M31.947,49.641 c0,6.627,5.371,11.998,11.998,11.998c3.616,0,12.979,0,15.998,0c4.418,0,7.999-3.582,7.999-7.998c0-4.418-3.581-8-7.999-8 c-1.6,0-3.083,0.482-4.334,1.291c-1.231-5.316-5.973-9.29-11.664-9.29C37.318,37.642,31.947,43.014,31.947,49.641z M51.496,35.545 c0.001,0,0.002,0,0.002,0S51.497,35.545,51.496,35.545z M59.155,30.85c-2.9,0.664-5.175,2.91-5.925,5.775l0,0 c1.918,1.372,3.523,3.152,4.68,5.22c0.664-0.113,1.337-0.205,2.033-0.205c2.618,0,5.033,0.85,7.005,2.271l0,0 c0.858-0.979,1.485-2.168,1.786-3.482C63.881,39.525,60.059,35.706,59.155,30.85z" />
  ),

  default: (
    <path d="M50,67.997c-4.418,0-7.999-3.581-7.999-7.999c0-2.025,0.759-3.869,1.999-5.278 	V38.001c0-3.313,2.687-5.999,6-5.999c3.312,0,5.999,2.686,5.999,5.999V54.72c1.24,1.409,2,3.253,2,5.278 C57.999,64.416,54.417,67.997,50,67.997z M51.999,56.553v-4.292V42v-3.999c0-1.104-0.896-2-1.999-2c-1.104,0-2,0.896-2,2V42v10.261 v4.292c-1.19,0.693-2,1.969-2,3.445c0,2.209,1.791,3.999,4,3.999c2.208,0,3.999-1.79,3.999-3.999 C53.999,58.521,53.189,57.246,51.999,56.553z" />
  ),
}

class PluginIcon extends Component {
  styles() {
    return {
      'hostname-icon': {
        fill: '#fff'
      }
    }
  }

  template(css) {
    return (
      <SvgIcon>
        <g fill="none" fillRule="evenodd">
          <g
            className={css('hostname-icon')}
            height="100"
            width="100"
            transform="scale(0.31,0.31) translate(-28,-16)"
          >
            {Icons[this.props.icon] || Icons.default}
          </g>
        </g>
      </SvgIcon>
    )
  }
}

export default class extends Component {
  constructor() {
    super()
    this.state = {
      conditions: {
        icon: '',
        temperature: null,
      },
    }
  }

  componentDidMount() {
    this.props.subscribe(() => {
      this.setWeatherConditions()
    }, 10000)
  }

  setWeatherConditions() {
    getWeather(this.props.weather || {})
      .then(conditions => this.setState({ conditions }))
      // Ignore errors, it's ok, lives aren't at stake here.
      .catch(() => {})
  }

  styles() {
    return {
      wrapper: {
        display: 'flex',
        alignItems: 'center'
      }
    }
  }

  template(css) {
    const { conditions } = this.state
    return (
      <div className={css('wrapper')}>
        <PluginIcon icon={conditions.icon} /> {Math.round(Number(conditions.temperature))}Â°F
      </div>
    )
  }
}
